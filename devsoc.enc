#include <Servo.h>

Servo myservo;

int blades=3,ir=5,pos=0,x=5,flag=0,fluct=200;
long presentrpm,prevrpm=0,currenttime=0,revpm=0,prevstate;
void setup() {
  // put your setup code here, to run once:
  pinMode(ir,INPUT);
  Serial.begin(9600);
myservo.attach(9);  // attaches the servo on pin 9 to the servo object
}

void loop() 
{
  // put your main code here, to run repeatedly:
currenttime=millis();
while((millis()-currenttime)<2000)
{
  prevstate=digitalRead(ir);
  
  if(prevstate!=digitalRead(ir))
  {revpm++;}
}
presentrpm=revpm*30/blades;
Serial.println(presentrpm);
revpm=0;

if(presentrpm-prevrpm>int(fluct/2) or abs(prevrpm-presentrpm)<fluct)
{
  pos=pos+x;
  myservo.write(pos);
  prevrpm = presentrpm;
}
  else
{
  prevrpm = presentrpm;
  if (!flag)
  {
    x = -x;
    flag = 1;  
  }
  else 
  {
    //delay(5000);
    flag = 0;
  }
  }
}

